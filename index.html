<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthcare Graph Knowledge Platform</title>

  <!-- vis-network -->
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <!-- PapaParse -->
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
    }

    header {
      padding: 14px 24px;
      background: #002b45;
      color: #ffffff;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header span {
      font-size: 13px;
      font-weight: 400;
      opacity: 0.9;
    }

    #status {
      padding: 8px 24px;
      font-size: 13px;
      background: #e9ecef;
      color: #333;
    }

    #network {
      width: 100%;
      height: calc(100vh - 110px);
      background: #ffffff;
    }

    .legend {
      position: absolute;
      top: 130px;
      right: 20px;
      background: #ffffff;
      border: 1px solid #ddd;
      padding: 10px 12px;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .legend div {
      margin-bottom: 6px;
    }

    .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 6px;
    }
  </style>
</head>
<body>

<header>
  Healthcare Graph Knowledge – Executive View
  <span>Interactive ontology & relationship exploration</span>
</header>

<div id="status">Loading graph data…</div>

<div id="network"></div>

<div class="legend">
  <div><span class="dot" style="background:#6c757d"></span>Property</div>
  <div><span class="dot" style="background:#0d6efd"></span>Membership</div>
  <div><span class="dot" style="background:#198754"></span>Beneficiary</div>
  <div><span class="dot" style="background:#dc3545"></span>Claim</div>
  <div><span class="dot" style="background:#fd7e14"></span>Financial Record</div>
  <div><span class="dot" style="background:#6610f2"></span>Provider</div>
  <div><span class="dot" style="background:#20c997"></span>Document</div>
</div>

<script>
  const statusEl = document.getElementById("status");

  const nodes = new vis.DataSet();
  const edges = new vis.DataSet();

  const colorMap = {
    Property: "#6c757d",
    Membership: "#0d6efd",
    Beneficiary: "#198754",
    Claim: "#dc3545",
    FinancialRecord: "#fd7e14",
    Provider: "#6610f2",
    Document: "#20c997"
  };

  function loadCSV(file, callback) {
    Papa.parse(file, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: callback,
      error: function(err) {
        alert("Failed to load " + file + ". Ensure the file exists at repo root.");
        console.error(err);
      }
    });
  }

  // Load Nodes
  loadCSV("Ontology_nodes_stm.csv", function(results) {
    results.data.forEach(row => {
      const labelText = row.name || row.class || row["~labels"] || "Node";

      nodes.add({
        id: row["~id"],
        label: labelText,
        title: `
          <b>Label:</b> ${row["~labels"] || "N/A"}<br/>
          <b>Class:</b> ${row.class || "N/A"}<br/>
          <b>Datatype:</b> ${row.datatype || "N/A"}
        `,
        color: colorMap[row["~labels"]] || "#adb5bd",
        shape: "dot",
        size: 18
      });
    });

    statusEl.innerText = "Nodes loaded. Loading relationships…";
  });

  // Load Relationships
  loadCSV("Ontology_relationship.csv", function(results) {
    results.data.forEach(row => {
      edges.add({
        from: row["~start_node_id"],
        to: row["~end_node_id"],
        label: row["~relationship_type"],
        arrows: "to",
        font: { align: "middle", size: 10 }
      });
    });

    renderGraph();
  });

  function renderGraph() {
    const container = document.getElementById("network");
    const data = { nodes, edges };

    const options = {
      interaction: {
        hover: true,
        navigationButtons: true,
        tooltipDelay: 200
      },
      physics: {
        stabilization: true,
        barnesHut: {
          gravitationalConstant: -35000,
          springLength: 120,
          springConstant: 0.04
        }
      },
      nodes: {
        font: { size: 14 }
      },
      edges: {
        color: "#343a40",
        smooth: true
      }
    };

    new vis.Network(container, data, options);

    statusEl.innerText =
      `Graph loaded: ${nodes.length} nodes, ${edges.length} relationships`;
  }
</script>

</body>
</html>
